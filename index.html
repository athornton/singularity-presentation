<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title></title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/talk.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress"><div class="step step-level-1" step="0" title="Singularity Containerization" author="Adam Thornton" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="singularity-a-new-kind-of-containerization">Singularity: A New Kind Of <a class="footnoteref" id="footnote-backref-id1" href="#footnote-id2">[*]</a> Containerization</h1><img src="images/Singularity-logo.svg"></img><h2 id="adam-thornton">Adam Thornton</h2><h2 id="speaking-as-a-private-individual">Speaking As A Private Individual</h2><p><a href="mailto:athornton@gmail.com">athornton@gmail.com</a></p><div class="footnote" id="footnote-id2"><a class="footnotereturn" href="#footnote-backref-id1" title="return to content">#*: </a><p>Not really.</p></div></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="what-s-the-point">What's the Point?</h1><p>Singularity is designed for situations, particularly HPC environments,
where you do not have "trusted users running trusted containers."</p><p>In particular, you want "untrusted users running untrusted
containers."</p><p>This is usually expressed as "no way you are letting Docker near my HPC
environment."</p></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="docker-s-security-model">Docker's Security Model</h1><img src="images/Dockerwhale.png"></img><img src="images/Dumpsterfire.gif"></img></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="slightly-more-detail">Slightly More Detail</h1><p>Docker (typically) runs privileged, and it's not too hard to engineer
root-in-the-container becoming root-outside-the-container.</p><p>This does tend to make security people twitchy, especially in
traditional shared-server HPC models.</p><p>Singularity attempts to address this.</p></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="what-singularity-does">What Singularity Does</h1><p>Runs a "container" where the owning user is the owning user and where the
network is the system network context.</p><ul><li>The filesystem and the process tree are apparently rooted in the
container context.</li><li>So, kind of like Docker without the network and UID namespaces.</li></ul></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="um-isn-t-that-a-chroot">Um, isn't that a chroot?</h1><p>Yes, but there's also a PID namespace.  So PID 1 in the Singularity
container isn't PID 1 outside.</p></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="also-magic-mounts">Also magic mounts</h1><p>Singularity automatically bind-mounts <tt>$HOME</tt>, <tt>/tmp</tt>, and <tt>/var/tmp</tt>.</p><p>And can bind-mount whatever else you tell it to.</p></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="but-privilege">But...privilege?</h1><p>Singularity has three modes:</p><ul><li>User namespace.  No bind mounts, ephemeral, doesn't mount images.
Effectively, pretty much useless.</li><li>Capabilities.  Obviously the way to do it, also a hard problem and
sysadmins don't understand them, so mostly a future research topic.</li><li>Or good old setuid binaries for mounting the image container, for
setting up the namespaces, and for bind-mounting local disks into the
container.</li></ul><img src="images/Picard-facepalm.jpg"></img><ul><li>Well, OK, still better than Docker.</li></ul></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="singularity-images">Singularity Images</h1><p>Singularity build specification file</p><ul><li>Called <tt>Singularity</tt></li><li>That's not confusing AT ALL.</li><li>Pretty much like a <tt>Dockerfile</tt> although the verb names are
different.</li></ul></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="docker-image-support">Docker Image support</h1><p>Singularity can import Docker images.</p><p>This actually is a pretty cool tool for manipulating Docker image layers
without needing to install Docker, if that's a thing you want to do.</p><p>Can save images to any of several formats, but mostly seems to do
<tt>.img</tt> "Singularity Images" which are just filesystem images mounted
via loopback.  This actually can increase performance if your typical
workload has many small writes, since you're just seeking in a file and
your IO requests get batched up before going to an actual device.</p></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="mutability">Mutability</h1><p>Singularity does provide for a mode where you have an immutable
container that you overlay with a mutable layer, so you can make changes
that are then discarded after you're done.  That plus bind mounts to
save your results gives you something that is pretty much equivalent to
a Docker container you run from an image and do not save when you're
done.</p></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="summary">Summary</h1><p>Singularity is a chroot, running from a loop-mounted image, with some
bind mounts, and a PID namespace.  It uses setuid binaries to accomplish
this, and the loop-mounted image can be a Docker image.</p></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="is-it-useful">Is it useful?</h1><p>Sure, I guess, if what you want to do is run Docker images without using
Docker.</p><ul><li>The use-case of an HPC environment with user shell access but <em>Docker?
Aw hell no!</em> is a real thing, and Singularity <strong>does</strong> address that.</li><li>Nevertheless: in my opinion you're better off finding a managed
Kubernetes provider and running your workload in containers there.</li><li>The lack of network namespacing makes Singularity less than useful for
multi-component applications.</li><li>However, it <em>is</em> good for wrapping up horrible scientific software
with terrible ancient dependencies so it can run your analysis without
destroying the rest of the system.</li><li>Which, to be fair, is pretty much the design goal.</li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="snark">Snark</h1><p>Did you think Docker was a lot of hype for something that's a kind of
crappy CLI wrapped around namespaces and cgroups?  Then you're gonna
really hate Singularity.  It's a chroot with a PID namespace and some
bind-mounts.</p><p>What's a Singularity?  A black hole, of course:</p><ul><li>...there's really nothing there, and...</li><li>...it kinda sucks.</li></ul></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>